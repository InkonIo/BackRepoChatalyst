# MVP –°–∏—Å—Ç–µ–º–∞ –¢–∞—Ä–∏—Ñ–æ–≤ - ChatalystBackend

## üéØ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

–°–∏—Å—Ç–µ–º–∞ —Ç–∞—Ä–∏—Ñ–æ–≤ –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è OpenAI API –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–¥–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

1. **–¢–∞—Ä–∏—Ñ–Ω—ã–µ –ø–æ–ª—è –≤ User** - –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è –¥–ª—è –ª–∏–º–∏—Ç–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –±–æ—Ç–æ–≤
2. **Flyway –º–∏–≥—Ä–∞—Ü–∏—è** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î
3. **QuotaService** - –∞—Ç–æ–º–∞—Ä–Ω–æ–µ —Å–ø–∏—Å–∞–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î
4. **ChatGateway** - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤ –ø–µ—Ä–µ–¥ OpenAI –≤—ã–∑–æ–≤–∞–º–∏
5. **TestPlanController** - —Ç–µ—Å—Ç–æ–≤—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —Ç–∞—Ä–∏—Ñ–æ–≤
6. **UserUsageController** - –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ª–∏–º–∏—Ç–∞—Ö —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
7. **SubscriptionRenewalService** - –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–æ–≤
8. **–ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—à–∏–±–æ–∫

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```bash
mvn spring-boot:run
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏
–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ Flyway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç –Ω–æ–≤—ã–µ –ø–æ–ª—è –≤ —Ç–∞–±–ª–∏—Ü–µ `users`.

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

#### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```bash
POST /api/auth/signup
{
  "email": "test@example.com",
  "password": "password123",
  "firstName": "Test",
  "lastName": "User"
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å —Ç–∞—Ä–∏—Ñ–æ–º `NONE` (0 —Å–æ–æ–±—â–µ–Ω–∏–π, 0 –±–æ—Ç–æ–≤)

#### –ê–∫—Ç–∏–≤–∞—Ü–∏—è Basic —Ç–∞—Ä–∏—Ñ–∞ (—Ç–µ—Å—Ç)
```bash
POST /api/test/plans/activate-basic?userId=1
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: 
- –õ–∏–º–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–π: 5000
- –ë–æ—Ç–æ–≤ –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å: 1
- –¢–∞—Ä–∏—Ñ: BASIC
- –î–µ–π—Å—Ç–≤—É–µ—Ç: 1 –º–µ—Å—è—Ü

#### –ê–∫—Ç–∏–≤–∞—Ü–∏—è Premium —Ç–∞—Ä–∏—Ñ–∞ (—Ç–µ—Å—Ç)
```bash
POST /api/test/plans/activate-premium?userId=1
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:
- –õ–∏–º–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–π: 20000
- –ë–æ—Ç–æ–≤ –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å: 5
- –¢–∞—Ä–∏—Ñ: PREMIUM
- –î–µ–π—Å—Ç–≤—É–µ—Ç: 1 –º–µ—Å—è—Ü

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤
```bash
GET /api/me/usage
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ–∫—É—â–∏—Ö –ª–∏–º–∏—Ç–∞—Ö –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### –°–±—Ä–æ—Å —Å—á–µ—Ç—á–∏–∫–∞ (—Ç–µ—Å—Ç)
```bash
POST /api/test/plans/reset-usage?userId=1
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –°—á–µ—Ç—á–∏–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π —Å–±—Ä–æ—à–µ–Ω –≤ 0

## üîß API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

### –¢–µ—Å—Ç–æ–≤—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

| –ú–µ—Ç–æ–¥ | URL | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|-----|----------|
| POST | `/api/test/plans/activate-basic?userId={id}` | –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å Basic —Ç–∞—Ä–∏—Ñ |
| POST | `/api/test/plans/activate-premium?userId={id}` | –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å Premium —Ç–∞—Ä–∏—Ñ |
| POST | `/api/test/plans/reset-usage?userId={id}` | –°–±—Ä–æ—Å–∏—Ç—å —Å—á–µ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π |
| GET | `/api/test/plans/usage/{userId}` | –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ª–∏–º–∏—Ç–∞—Ö |

### –ü—Ä–æ–¥–∞–∫—à–Ω —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

| –ú–µ—Ç–æ–¥ | URL | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|-----|----------|
| GET | `/api/me/usage` | –õ–∏–º–∏—Ç—ã —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |

## üìä –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –±–æ—Ç–∞
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è `botsAllowed` —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç—Å—è —Å —Ç–µ–∫—É—â–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –±–æ—Ç–æ–≤
- –ï—Å–ª–∏ –ª–∏–º–∏—Ç –∏—Å—á–µ—Ä–ø–∞–Ω ‚Üí –æ—à–∏–±–∫–∞ 402

### 2. OpenAI –≤—ã–∑–æ–≤—ã
- –ö–∞–∂–¥—ã–π –≤—ã–∑–æ–≤ —Å–ø–∏—Å—ã–≤–∞–µ—Ç 1 —Å–æ–æ–±—â–µ–Ω–∏–µ
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è `monthlyMessagesUsed < monthlyMessagesLimit`
- –ï—Å–ª–∏ –ª–∏–º–∏—Ç –∏—Å—á–µ—Ä–ø–∞–Ω ‚Üí –æ—à–∏–±–∫–∞ 402 (Payment Required)

### 3. –ê–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ
- –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 00:00 (Asia/Almaty)
- –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è `monthlyMessagesUsed`
- –ü—Ä–æ–¥–ª–µ–≤–∞–µ—Ç—Å—è `subscriptionEnd` –Ω–∞ –º–µ—Å—è—Ü

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ E2E

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è ‚Üí —Ç–∞—Ä–∏—Ñ NONE
2. –ü–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞—Ç—å –±–æ—Ç–∞ ‚Üí –æ—à–∏–±–∫–∞ "–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ç–∞—Ä–∏—Ñ–∞"
3. –ü–æ–ø—ã—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Üí –æ—à–∏–±–∫–∞ "–õ–∏–º–∏—Ç –∏—Å—á–µ—Ä–ø–∞–Ω"

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ê–∫—Ç–∏–≤–∞—Ü–∏—è Basic —Ç–∞—Ä–∏—Ñ–∞
1. –ê–∫—Ç–∏–≤–∞—Ü–∏—è Basic ‚Üí 0/5000 —Å–æ–æ–±—â–µ–Ω–∏–π, 1 –±–æ—Ç
2. –°–æ–∑–¥–∞–Ω–∏–µ –±–æ—Ç–∞ ‚Üí —É—Å–ø–µ—à–Ω–æ
3. –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π ‚Üí —Å–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –ø–æ 1

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ò—Å—á–µ—Ä–ø–∞–Ω–∏–µ –ª–∏–º–∏—Ç–∞
1. –î–æ–≤–µ—Å—Ç–∏ —Å—á–µ—Ç—á–∏–∫ –¥–æ 5000
2. –°–ª–µ–¥—É—é—â–∏–π –∑–∞–ø—Ä–æ—Å ‚Üí –æ—à–∏–±–∫–∞ 402
3. –°–±—Ä–æ—Å —Å—á–µ—Ç—á–∏–∫–∞ ‚Üí —Å–Ω–æ–≤–∞ 0/5000

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –ê–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ
1. –î–æ–∂–¥–∞—Ç—å—Å—è 00:00 –∏–ª–∏ –≤—ã–∑–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–±—Ä–æ—Å —Å—á–µ—Ç—á–∏–∫–∞
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–¥–ª–µ–Ω–∏–µ –¥–∞—Ç—ã

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- **–ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** - –∑–∞—â–∏—Ç–∞ –æ—Ç –≥–æ–Ω–æ–∫ –ø—Ä–∏ —Å–ø–∏—Å–∞–Ω–∏–∏
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤** - —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü –±–æ—Ç–∞ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–∏–º–∏—Ç—ã
- **–í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∞—Ä–∏—Ñ–æ–≤** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–¥–ø–∏—Å–∫–∏

## üìù TODO –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω–∞

1. **–†–µ–∞–ª—å–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø–ª–∞—Ç–µ–∂–Ω—ã–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏
2. **–ò—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π** - —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è –∞—É–¥–∏—Ç–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
3. **–¢–æ–∫–µ–Ω—ã –≤–º–µ—Å—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–π** - –±–æ–ª–µ–µ —Ç–æ—á–Ω—ã–π –ø–æ–¥—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏
4. **–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –ª–∏–º–∏—Ç—ã** - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –∫–æ–Ω–µ—á–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
5. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** - email/SMS –æ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞

## üêõ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è MVP

1. **–§–µ–π–∫–æ–≤—ã–µ —Ç–∞—Ä–∏—Ñ—ã** - —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
2. **–ê–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ** - –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–π –æ–ø–ª–∞—Ç—ã
3. **–ü—Ä–æ—Å—Ç–æ–π –ø–æ–¥—Å—á–µ—Ç** - 1 –∑–∞–ø—Ä–æ—Å = 1 —Å–æ–æ–±—â–µ–Ω–∏–µ
4. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏—Å—Ç–æ—Ä–∏–∏** - –Ω–µ—Ç –∞—É–¥–∏—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏
- `QuotaService` - —Å–ø–∏—Å–∞–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤
- `ChatGateway` - –≤—ã–∑–æ–≤—ã OpenAI
- `SubscriptionRenewalService` - –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ

### –ú–µ—Ç—Ä–∏–∫–∏
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ 402 –æ—à–∏–±–æ–∫ (–ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–æ–≤ –ø–æ —Ç–∏–ø–∞–º
- –°—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ë–î (—Ç–∞–±–ª–∏—Ü–∞ `users`)
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Flyway
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å cron-–∑–∞–¥–∞–Ω–∏—è –¥–ª—è –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏—è
